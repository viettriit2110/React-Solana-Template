{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SolanaWallet = void 0;\nconst web3_js_1 = require(\"@solana/web3.js\");\nconst bs58_1 = __importDefault(require(\"bs58\"));\nconst buffer_1 = require(\"buffer\");\nclass SolanaWallet {\n  constructor(auth, rpcUrl) {\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this.isParticleNetwork = true;\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this._connecting = false;\n    const userInfo = this.auth.userInfo();\n    if (userInfo) {\n      const wallet = userInfo.wallets.find(w => w.chain_name === \"solana\" && w.public_address.length > 0);\n      if (wallet) {\n        this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      } else {\n        this._publicKey = null;\n      }\n    } else {\n      this._publicKey = null;\n    }\n    this.auth.on(\"connect\", userInfo => {\n      const wallet = userInfo.wallets.find(w => w.chain_name === \"solana\" && w.public_address.length > 0);\n      if (wallet) {\n        this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      }\n    });\n    this.auth.on(\"disconnect\", () => {\n      this._publicKey = null;\n    });\n  }\n  get connecting() {\n    return this._connecting;\n  }\n  get connected() {\n    return this._publicKey !== null;\n  }\n  get publicKey() {\n    return this._publicKey;\n  }\n  connect(config) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        this._connecting = true;\n        let wallet = this.auth.wallet();\n        if (wallet) {\n          this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n          return Promise.resolve();\n        }\n        yield this.auth.login(config);\n        wallet = this.auth.wallet();\n        if (wallet) {\n          this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n          return Promise.resolve();\n        } else {\n          return Promise.reject(\"wallet create failed\");\n        }\n      } catch (e) {\n        return Promise.reject(e);\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.auth.logout();\n      this._publicKey = null;\n      return Promise.resolve();\n    });\n  }\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signature = yield this.auth.sign(\"signTransaction\", bs58_1.default.encode(transaction.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      })));\n      return web3_js_1.Transaction.from(buffer_1.Buffer.from(signature, \"base64\"));\n    });\n  }\n  signAllTransactions(transactions) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signatures = yield this.auth.signAllTransactions(transactions.map(tx => bs58_1.default.encode(tx.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      }))));\n      return signatures.map(signed => web3_js_1.Transaction.from(buffer_1.Buffer.from(signed, \"base64\")));\n    });\n  }\n  signAndSendTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      return this.auth.sendTransaction(bs58_1.default.encode(transaction.serialize({\n        requireAllSignatures: false,\n        verifySignatures: false\n      })));\n    });\n  }\n  signMessage(message) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const signature = yield this.auth.sign(\"signMessage\", bs58_1.default.encode(message));\n      return buffer_1.Buffer.from(signature, \"base64\");\n    });\n  }\n  getConnection(config) {\n    const url = this.rpcUrl ? this.rpcUrl + \"/solana/rpc\" : \"https://api.particle.network/solana-chain/rpc\";\n    return new web3_js_1.Connection(`${url}?chainId=${this.auth.chainId()}`, {\n      commitment: config === null || config === void 0 ? void 0 : config.commitment,\n      wsEndpoint: config === null || config === void 0 ? void 0 : config.wsEndpoint,\n      httpHeaders: {\n        Authorization: this.auth.basicCredentials()\n      },\n      fetch: config === null || config === void 0 ? void 0 : config.fetch,\n      fetchMiddleware: config === null || config === void 0 ? void 0 : config.fetchMiddleware,\n      disableRetryOnRateLimit: config === null || config === void 0 ? void 0 : config.disableRetryOnRateLimit,\n      confirmTransactionInitialTimeout: config === null || config === void 0 ? void 0 : config.confirmTransactionInitialTimeout\n    });\n  }\n}\nexports.SolanaWallet = SolanaWallet;","map":{"version":3,"mappings":"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","names":["SolanaWallet","constructor","auth","rpcUrl","_connecting","userInfo","wallet","wallets","find","w","chain_name","public_address","length","_publicKey","web3_js_1","on","connecting","connected","publicKey","connect","config","Promise","resolve","login","reject","e","disconnect","logout","signTransaction","transaction","signature","sign","bs58_1","encode","serialize","requireAllSignatures","verifySignatures","from","buffer_1","signAllTransactions","transactions","signatures","map","tx","signed","signAndSendTransaction","sendTransaction","signMessage","message","getConnection","url","chainId","commitment","wsEndpoint","httpHeaders","Authorization","basicCredentials","fetch","fetchMiddleware","disableRetryOnRateLimit","confirmTransactionInitialTimeout","exports"],"sourceRoot":"","sources":["../src/solana-wallet.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}